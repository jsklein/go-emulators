package main
import (
    "fmt" 
    "net"  
    "reflect"
)


func sendResponse(conn *net.UDPConn, addr *net.UDPAddr) {
    response := "\x48\x54\x54\x50\x2F\x31\x2E\x31\x20\x32\x30\x30\x20\x4F\x4B\x0D\x0A\x43\x61\x63\x68\x65\x2D\x43\x6F\x6E\x74\x72\x6F\x6C\x3A\x20\x6D\x61\x78\x2D\x61\x67\x65\x3D\x31\x32\x30\x0D\x0A\x4C\x6F\x63\x61\x74\x69\x6F\x6E\x3A\x20\x68\x74\x74\x70\x3A\x2F\x2F\x31\x39\x32\x2E\x31\x36\x38\x2E\x30\x2E\x31\x3A\x36\x35\x35\x33\x35\x2F\x72\x6F\x6F\x74\x44\x65\x73\x63\x2E\x78\x6D\x6C\x0D\x0A\x53\x65\x72\x76\x65\x72\x3A\x20\x4C\x69\x6E\x75\x78\x2F\x32\x2E\x34\x2E\x32\x32\x2D\x31\x2E\x32\x31\x31\x35\x2E\x6E\x70\x74\x6C\x20\x55\x50\x6E\x50\x2F\x31\x2E\x30\x20\x6D\x69\x6E\x69\x75\x70\x6E\x70\x64\x2F\x31\x2E\x30\x0D\x0A\x53\x54\x3A\x20\x75\x72\x6E\x3A\x73\x63\x68\x65\x6D\x61\x73\x2D\x75\x70\x6E\x70\x2D\x6F\x72\x67\x3A\x64\x65\x76\x69\x63\x65\x3A\x49\x6E\x74\x65\x72\x6E\x65\x74\x47\x61\x74\x65\x77\x61\x79\x44\x65\x76\x69\x63\x65\x3A\x0D\x0A\x55\x53\x4E\x3A\x20\x75\x75\x69\x64\x3A\x62\x31\x63\x35\x64\x36\x30\x63\x2D\x31\x64\x64\x31\x2D\x31\x31\x62\x32\x2D\x38\x36\x38\x37\x2D\x61\x30\x62\x63\x38\x66\x37\x36\x64\x36\x34\x34\x3A\x3A\x75\x72\x6E\x3A\x73\x63\x68\x65\x6D\x61\x73\x2D\x75\x70\x6E\x70\x2D\x6F\x72\x67\x3A\x64\x65\x76\x69\x63\x65\x3A\x49\x6E\x74\x65\x72\x6E\x65\x74\x47\x61\x74\x65\x77\x61\x79\x44\x65\x76\x69\x63\x65\x3A\x0D\x0A\x0D\x0A\x48\x54\x54\x50\x2F\x31\x2E\x31\x20\x32\x30\x30\x20\x4F\x4B\x0D\x0A\x43\x41\x43\x48\x45\x2D\x43\x4F\x4E\x54\x52\x4F\x4C\x3A\x20\x6D\x61\x78\x2D\x61\x67\x65\x20\x3D\x20\x31\x32\x30\x0D\x0A\x4C\x4F\x43\x41\x54\x49\x4F\x4E\x3A\x20\x68\x74\x74\x70\x3A\x2F\x2F\x31\x39\x32\x2E\x31\x36\x38\x2E\x31\x2E\x31\x3A\x38\x30\x2F\x55\x50\x6E\x50\x2F\x49\x47\x44\x2E\x78\x6D\x6C\x0D\x0A\x53\x54\x3A\x20\x75\x72\x6E\x3A\x73\x63\x68\x65\x6D\x61\x73\x2D\x75\x70\x6E\x70\x2D\x6F\x72\x67\x3A\x73\x65\x72\x76\x69\x63\x65\x3A\x57\x41\x4E\x49\x50\x43\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E\x3A\x31\x0D\x0A\x53\x45\x52\x56\x45\x52\x3A\x20\x53\x79\x73\x74\x65\x6D\x2F\x31\x2E\x30\x20\x55\x50\x6E\x50\x2F\x31\x2E\x30\x20\x49\x47\x44\x2F\x31\x2E\x30\x0D\x0A\x55\x53\x4E\x3A\x20\x75\x75\x69\x64\x3A\x57\x41\x4E\x43\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E\x7B\x39\x36\x37\x39\x64\x35\x36\x36\x2D\x32\x33\x30\x61\x2D\x34\x39\x64\x33\x2D\x39\x32\x65\x35\x2D\x34\x32\x31\x65\x39\x32\x32\x33\x65\x61\x65\x66\x7D\x30\x30\x30\x30\x30\x30\x30\x30\x30\x30\x30\x30\x3A\x3A\x75\x72\x6E\x3A\x73\x63\x68\x65\x6D\x61\x73\x2D\x75\x70\x6E\x70\x2D\x6F\x72\x67\x3A\x73\x65\x72\x76\x69\x63\x65\x3A\x57\x41\x4E\x49\x50\x43\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E\x3A\x31\x0D\x0A\x0D\x0A\x48\x54\x54\x50\x2F\x31\x2E\x31\x20\x32\x30\x30\x20\x4F\x4B\x0D\x0A\x53\x65\x72\x76\x65\x72\x3A\x20\x43\x75\x73\x74\x6F\x6D\x2F\x31\x2E\x30\x20\x55\x50\x6E\x50\x2F\x31\x2E\x30\x20\x50\x72\x6F\x63\x2F\x56\x65\x72\x0D\x0A\x4C\x6F\x63\x61\x74\x69\x6F\x6E\x3A\x20\x68\x74\x74\x70\x3A\x2F\x2F\x31\x39\x32\x2E\x31\x36\x38\x2E\x31\x2E\x31\x3A\x35\x34\x33\x31\x2F\x64\x79\x6E\x64\x65\x76\x2F\x75\x75\x69\x64\x3A\x32\x30\x34\x65\x37\x66\x63\x65\x2D\x31\x31\x38\x65\x2D\x38\x65\x31\x31\x2D\x63\x65\x37\x66\x2D\x34\x65\x32\x30\x34\x65\x63\x65\x38\x65\x30\x30\x30\x30\x0D\x0A\x43\x61\x63\x68\x65\x2D\x43\x6F\x6E\x74\x72\x6F\x6C\x3A\x6D\x61\x78\x2D\x61\x67\x65\x3D\x31\x38\x30\x30\x0D\x0A\x53\x54\x3A\x75\x75\x69\x64\x3A\x32\x30\x34\x65\x37\x66\x63\x65\x2D\x31\x31\x38\x65\x2D\x38\x65\x31\x31\x2D\x63\x65\x37\x66\x2D\x34\x65\x32\x30\x34\x65\x63\x65\x38\x65\x30\x30\x30\x32\x0D\x0A\x55\x53\x4E\x3A\x75\x75\x69\x64\x3A\x32\x30\x34\x65\x37\x66\x63\x65\x2D\x31\x31\x38\x65\x2D\x38\x65\x31\x31\x2D\x63\x65\x37\x66\x2D\x34\x65\x32\x30\x34\x65\x63\x65\x38\x65\x30\x30\x30\x32\x0D\x0A\x0D\x0A\x48\x54\x54\x50\x2F\x31\x2E\x31\x20\x32\x30\x30\x20\x4F\x4B\x0D\x0A\x43\x41\x43\x48\x45\x2D\x43\x4F\x4E\x54\x52\x4F\x4C\x3A\x20\x6D\x61\x78\x2D\x61\x67\x65\x20\x3D\x20\x31\x32\x30\x0D\x0A\x4C\x4F\x43\x41\x54\x49\x4F\x4E\x3A\x20\x68\x74\x74\x70\x3A\x2F\x2F\x31\x39\x32\x2E\x31\x36\x38\x2E\x31\x2E\x31\x3A\x38\x30\x2F\x55\x50\x6E\x50\x2F\x49\x47\x44\x2E\x78\x6D\x6C\x0D\x0A\x53\x54\x3A\x20\x75\x72\x6E\x3A\x73\x63\x68\x65\x6D\x61\x73\x2D\x75\x70\x6E\x70\x2D\x6F\x72\x67\x3A\x64\x65\x76\x69\x63\x65\x3A\x57\x41\x4E\x44\x65\x76\x69\x63\x65\x3A\x31\x0D\x0A\x53\x45\x52\x56\x45\x52\x3A\x20\x53\x79\x73\x74\x65\x6D\x2F\x31\x2E\x30\x20\x55\x50\x6E\x50\x2F\x31\x2E\x30\x20\x49\x47\x44\x2F\x31\x2E\x30\x0D\x0A\x55\x53\x4E\x3A\x20\x75\x75\x69\x64\x3A\x57\x41\x4E\x7B\x38\x34\x38\x30\x37\x35\x37\x35\x2D\x32\x35\x31\x62\x2D\x34\x63\x30\x32\x2D\x39\x35\x34\x62\x2D\x65\x38\x65\x32\x62\x61\x37\x32\x31\x36\x61\x39\x7D\x30\x30\x30\x30\x30\x30\x30\x30\x30\x30\x30\x30\x3A\x3A\x75\x72\x6E\x3A\x73\x63\x68\x65\x6D\x61\x73\x2D\x75\x70\x6E\x70\x2D\x6F\x72\x67\x3A\x64\x65\x76\x69\x63\x65\x3A\x57\x41\x4E\x44\x65\x76\x69\x63\x65\x3A\x31\x0D\x0A\x0D\x0A"
    _,err := conn.WriteToUDP([]byte(response), addr)
    // fmt.Printf("Success")
    if err != nil {
        fmt.Printf("Couldn't send response %v", err)
    }
}


func main() {
    p := make([]byte, 2048)
    addr := net.UDPAddr{
        Port: 1900,
        IP: net.ParseIP("0.0.0.0"),
    }
    ser, err := net.ListenUDP("udp", &addr)
    if err != nil {
        fmt.Printf("Some error %v\n", err)
        return
    }
    for {
        _,remoteaddr,err := ser.ReadFromUDP(p)
        // fmt.Printf("Read a message from %v %s \n", remoteaddr, p)
        m := []byte("M-SEARCH")
	pp := []byte(p)[0:8]
	if reflect.DeepEqual(pp, m) {
		go sendResponse(ser, remoteaddr)	
		}
	// fmt.Println(pp,m)
	if err !=  nil {
            fmt.Printf("Some error  %v", err)
            continue
        }
        continue
      }
}
